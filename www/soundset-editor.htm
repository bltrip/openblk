<!DOCTYPE html>
<html>
<head>

   <link rel="stylesheet" href="css/main.css" type="text/css" />
   <link rel="stylesheet" href="css/search.css" type="text/css" />
   
   <style>
       .url-input {width: 300px;}
       /*button {width: 100%; height: 40px; background-color: blue;}*/
       textarea {width: 400px; height: 100px;}
   </style>

</head>
<body>

   <div class="main-title-bar">
         <div class="main-title-bar-content">
         <a class="main-page-link" href="index.htm">
         <span class="main-title-open">Open</span><span class="main-title-media">Music</span><span class="main-title-gallery">.Gallery</span>
         </a>

         <div class="main-title-bar-right">
            <div class="title-bar-user-controls"></div>
         </div>
      </div>

   </div>

   <div class="main-body">
       
       <h1>Add/Edit a Sound Set</h1>
       Sound Set Name: 
       <br>
       <input id="soundset-name">
       
       <br>
       Default Surface: <select id="default-surface">
                       <option value="PRESET_VERTICAL">Vertical</option>
                       <option value="PRESET_FRETBOARD">Fretboard</option>
                       <option value="PRESET_SEQUENCER">Sequencer</option>
                       </select>
       Chromatic: <input type="checkbox" id="chromatic-checkbox"> 
       <!--Low Note: <input id="low-note"> 
       High Note: <input id="high-note"> -->
       
      
      <div class="search-info">
       Sound 1 Name:
       
       <input id="sound-1-name">
       
       URL:
       
       <input id="sound-1-url" class="url-input">
      </div>

      <div class="search-info">
       Sound 2 Name:
       
       <input id="sound-2-name">
       
       URL:
       
       <input id="sound-2-url" class="url-input">
      </div>

      <div class="search-info">
       Sound 3 Name:
       
       <input id="sound-3-name">
       
       URL:
       
       <input id="sound-3-url" class="url-input">
      </div>

      <div class="search-info">
       Sound 4 Name:
       
       <input id="sound-4-name">
       
       URL:
       
       <input id="sound-4-url" class="url-input">
      </div>

      <div class="search-info">
       Sound 5 Name:
       
       <input id="sound-5-name">
       
       URL:
       
       <input id="sound-5-url" class="url-input">
      </div>

      <div class="search-info">
       Sound 6 Name:
       
       <input id="sound-6-name">
       
       URL:
       
       <input id="sound-6-url" class="url-input">
      </div>

      <div class="search-info">
       Sound 7 Name:
       
       <input id="sound-7-name">
       
       URL:
       
       <input id="sound-7-url" class="url-input">
      </div>

      <div class="search-info">
       Sound 8 Name:
       
       <input id="sound-8-name">
       
       URL:
       
       <input id="sound-8-url" class="url-input">
      </div>


      <button class="main-create-something" id="submit-button">Submit Sound Set</button>
      
      <div>Or Batch Input:</div>
      <textarea id="batch-input"></textarea>
      <br>
      <button class="main-create-something" id="submit-button2">Load Batch</button>
   
   </div>

   <script src="js/usercontrols.js"></script>
   <script>
   setupUserControls(document.getElementsByClassName("title-bar-user-controls")[0]);
   </script>

   <script src="js/omgservice.js"></script>
   <script>
   var omgservice = new OMGService();

   for (var i = 1; i < 9; i++) {
       urlElement = document.getElementById("sound-" + i + "-url");
       urlElement.addEventListener ("paste", function (e) {
           console.log(e.clipboardData.getData("Text"));
            
           var nameInput = document.getElementById(e.target.id.replace("url", "name"));
           if (nameInput.value.length == 0) {
               
               var filename;           
               filename = e.clipboardData.getData("Text");
               
               nameInput.value = filename.split("/").pop().split(".")[0]
           }
       }, false);
   }
       
   document.getElementById("submit-button").onclick = function () {
       var newSoundSet = {type: "SOUNDSET", 
              name: document.getElementById("soundset-name").value, 
              data: [],
              chromatic: document.getElementById("chromatic-checkbox").checked,
              defaultSurface: document.getElementById("default-surface").value
        };
        
        if (params.id)
            newSoundSet.id = params.id;
        
        var cap, url
        for (var i = 1; i < 9; i++) {
            url = document.getElementById("sound-" + i + "-url").value;
            cap = document.getElementById("sound-" + i + "-name").value;
            if (url.length > 0 && cap.length > 0) {
                newSoundSet.data.push({url: url, name: cap});
            }
        }
        
        console.log(JSON.stringify(newSoundSet));
        
        if (newSoundSet.name.length > 0 && newSoundSet.data.length > 0) {
            omgservice.post(newSoundSet, function (response) {
                console.log(response);
                
                //var responseO = JSON.parse(response);
                if (response.id > 0) {
                    window.location = "soundset.htm?id=" + response.id;
                }
            });
        }
        else {
            alert("SoundSet needs a name, and a sound with a caption and url.")
        }
   };
   
   
   document.getElementById("submit-button2").onclick = function () {
       var newSoundSet = {type: "SOUNDSET", 
              name: document.getElementById("soundset-name").value, 
              data: [], 
        };
        
        var lines = document.getElementById("batch-input").value.split("\n");
        var cap, url
        for (var i = 1; i <= lines.length; i++) {
            document.getElementById("sound-" + i + "-url").value = lines[i - 1];
            document.getElementById("sound-" + i + "-name").value = lines[i - 1].split("/").pop().split(".")[0];
        }
        
   };
   
   var params = omgservice.getQueryString();
   if (params.id) {
        
        omgservice.getId(params.id, function (response) {
            document.getElementById("soundset-name").value = response.name;
            var newDiv;
            for (var i = 0; i < response.data.length; i++) {
                document.getElementById("sound-" + (i+1) + "-url").value = 
                    response.data[i].url;
                document.getElementById("sound-" + (i+1) + "-name").value = 
                    response.data[i].name;
            }
        });
        
    }

   </script>

</body>
</html>
