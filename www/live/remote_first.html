<!DOCTYPE html>
<html>
<head>
<style>
body {
    margin:0px;
    height:100%;
}
#main-canvas {position:absolute;
             width:100%;
             height:100%;}
</style>

<script src="/socket.io/socket.io.js"></script>
<script>
  var socket = io("/user");
</script>
</head>

<body>

<canvas id="main-canvas">
</canvas>

<script>
var canvas = document.getElementById("main-canvas");

var isTouching = false;

var colors = [ "#FFFFFF", "#FF0000", "#FFFF00", "#00FF00", "#0000FF",
            "#FF8000", "#9E9E9E", "#00FFFF", "#800080", "#632DFF", "#63FF08" ];

var colorI = Math.floor(Math.random() * colors.length);
if (window.location.search) {
   colorI = parseInt(window.location.search.substring(1));
}

var color = colors[colorI];
console.log(color);

colors.forEach(function (c, i) {
   var newElement = document.createElement("div");
   newElement.style.backgroundColor = c;
   newElement.onclick = function () {
      colorI = i;   
      color = c;
   };
   newElement.style.display = "inline-block";
   newElement.style.position = "relative";
   newElement.style.height = "10%";
   newElement.style.width = "10%";
   document.body.appendChild(newElement);
});


//document.body.appendChild(canvas);
//canvas.height = canvas.parentElement.clientHeight - canvas.offsetTop;
//canvas.style.height = canvas.height + "px";

var height = window.innerHeight;
var width = window.innerWidth;
canvas.clientWidth = width;
canvas.clientHeight = height;
canvas.width = canvas.clientWidth;
canvas.height = canvas.clientHeight;

var username = Math.random().toString(36).substr(2);

canvas.style.backgroundColor = color;
var ctx = canvas.getContext("2d");


if (window.innerWidth < window.innerHeight) {

}

var drawCircle = function (x, y) {

    canvas.width = canvas.width;
    ctx.lineWidth = 3;
        
    ctx.beginPath();
    ctx.arc(x, y, 12, 0, 2 * Math.PI);
    ctx.stroke();
    
};

var canvasDownEvent = function (x, y) {
    isTouching = true;
    drawCircle(x, y); 
    
    socket.emit("playnote", {'user': username, 'x': x/width, 'y': y/height, 'colorI': colorI});
};

var canvasMoveEvent = function (x, y) {
    if (isTouching){
        drawCircle(x, y);    
        socket.emit("playnote", {'user': username, 'x': x/width, 'y': y/height, 'colorI': colorI});
    }
};

var canvasEndEvent = function (x, y) {
    isTouching = false;    
    canvas.width = canvas.width;
    socket.emit("playnote", {'user': username, 'x':-1});
};



canvas.ontouchstart = function (e) {
	e.preventDefault();
	canvasDownEvent(e.targetTouches[0].pageX, e.targetTouches[0].pageY);
};
canvas.ontouchmove = function (e) {
	e.preventDefault();
	canvasMoveEvent(e.targetTouches[0].pageX, e.targetTouches[0].pageY);
};
canvas.ontouchend = function (e) {
	e.preventDefault();
	canvasEndEvent(-1, -1);
};


canvas.onmousedown = function (e) {
    canvasDownEvent(e.clientX, e.clientY);
};
canvas.onmousemove = function (e) {
    canvasMoveEvent(e.clientX, e.clientY);
};
canvas.onmouseup = function (e) {
    canvasEndEvent(e.clientX, e.clientY);
};

</script>

</body>
</html>
